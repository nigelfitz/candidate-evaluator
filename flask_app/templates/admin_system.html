<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Settings - Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .admin-container { max-width: 1200px; margin: 0 auto; }
        .settings-card { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); padding: 30px; margin-bottom: 20px; }
        .logout-btn { position: fixed; top: 20px; right: 20px; }
        
        /* Tab Navigation */
        .admin-tabs { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); padding: 15px 30px; margin-bottom: 20px; }
        .admin-tabs a { color: #666; text-decoration: none; padding: 12px 24px; display: inline-block; border-bottom: 3px solid transparent; font-weight: 500; transition: all 0.3s; }
        .admin-tabs a:hover { color: #667eea; }
        .admin-tabs a.active { color: #667eea; border-bottom-color: #667eea; }
        
        .setting-item { border-bottom: 1px solid #e0e0e0; padding: 25px 0; }
        .setting-item:last-child { border-bottom: none; }
        .setting-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .setting-name { font-weight: 600; color: #333; font-size: 1.1rem; }
        .setting-desc { color: #666; margin-top: 8px; font-size: 0.95rem; }
        .toggle-switch { position: relative; width: 60px; height: 30px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 30px; }
        .slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #667eea; }
        input:checked + .slider:before { transform: translateX(30px); }
        
        .warning-box { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .success-msg { background: #d4edda; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745; margin-bottom: 20px; }
        .btn-save { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 12px 30px; font-size: 1.1rem; }
        .btn-save:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
    </style>
</head>
<body>
    <a href="{{ url_for('admin_logout') }}" class="btn btn-danger logout-btn">üîí Logout</a>
    
    <div class="admin-container">
        <!-- Tab Navigation -->
        <div class="admin-tabs">
            <a href="{{ url_for('admin_gpt_settings') }}" class="{% if active_tab == 'gpt' %}active{% endif %}">ü§ñ GPT Settings</a>
            <a href="{{ url_for('admin_prompts') }}" class="{% if active_tab == 'prompts' %}active{% endif %}">üí¨ Prompts</a>
            <a href="{{ url_for('admin_users') }}" class="{% if active_tab == 'users' %}active{% endif %}">üë• Users</a>
            <a href="{{ url_for('admin_system') }}" class="{% if active_tab == 'system' %}active{% endif %}">‚öôÔ∏è System</a>
            <a href="{{ url_for('admin_stats') }}" class="{% if active_tab == 'stats' %}active{% endif %}">üìä Stats</a>
            <a href="{{ url_for('admin_feedback') }}" class="{% if active_tab == 'feedback' %}active{% endif %}">üí¨ Feedback</a>
        </div>
        
        <div class="settings-card">
            <h1 class="text-center mb-4">‚öôÔ∏è System Settings</h1>
            
            {% if message %}
            <div class="success-msg">
                ‚úÖ {{ message }}
            </div>
            {% endif %}
            
            <div class="warning-box">
                <strong>‚ö†Ô∏è Important:</strong> These settings control critical system behavior. Changes take effect immediately.
            </div>
            
            <form method="POST" action="{{ url_for('admin_system_save') }}">
                <!-- Registration Toggle -->
                <div class="setting-item">
                    <div class="setting-header">
                        <div>
                            <div class="setting-name">{{ settings.registration_enabled.label }}</div>
                            <div class="setting-desc">{{ settings.registration_enabled.description }}</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" name="registration_enabled" {% if settings.registration_enabled.value %}checked{% endif %}>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div style="margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; font-size: 0.9rem;">
                        <strong>Current Status:</strong> 
                        {% if settings.registration_enabled.value %}
                            <span style="color: #28a745;">‚úì Registration is ENABLED</span> - New users can create accounts
                        {% else %}
                            <span style="color: #dc3545;">‚úï Registration is DISABLED</span> - New signups will see "Please check back soon" message
                        {% endif %}
                    </div>
                </div>
                
                <!-- Maintenance Mode -->
                <div class="setting-item">
                    <div class="setting-header">
                        <div>
                            <div class="setting-name">{{ settings.maintenance_mode.label }}</div>
                            <div class="setting-desc">{{ settings.maintenance_mode.description }}</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" name="maintenance_mode" {% if settings.maintenance_mode.value %}checked{% endif %}>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <!-- Max File Size -->
                <div class="setting-item">
                    <div class="setting-name">{{ settings.max_file_size_mb.label }}</div>
                    <div class="setting-desc">{{ settings.max_file_size_mb.description }}</div>
                    <div style="display: flex; align-items: center; gap: 15px; margin-top: 15px;">
                        <input type="range" name="max_file_size_mb" class="form-range flex-grow-1" 
                               min="5" max="50" step="5" value="{{ settings.max_file_size_mb.value }}"
                               oninput="this.nextElementSibling.value = this.value + ' MB'">
                        <output class="badge bg-primary" style="min-width: 80px; text-align: center; font-size: 1rem;">{{ settings.max_file_size_mb.value }} MB</output>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: #666; margin-top: 5px;">
                        <span>5 MB</span>
                        <span>25 MB (Recommended)</span>
                        <span>50 MB</span>
                    </div>
                </div>
                
                <!-- Welcome Credit -->
                <div class="setting-item">
                    <div class="setting-name">{{ settings.new_user_welcome_credit.label }}</div>
                    <div class="setting-desc">{{ settings.new_user_welcome_credit.description }}</div>
                    <div style="display: flex; align-items: center; gap: 15px; margin-top: 15px;">
                        <span style="font-size: 1.2rem; font-weight: 600;">$</span>
                        <input type="number" name="new_user_welcome_credit" class="form-control" 
                               style="max-width: 150px;" step="0.50" min="0" max="50" value="{{ settings.new_user_welcome_credit.value }}">
                    </div>
                    <div style="margin-top: 15px; padding: 12px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107; font-size: 0.9rem;">
                        <strong>‚ö†Ô∏è Production Reminder:</strong> Set this to $0.00 before going live. Only use non-zero values for testing.
                    </div>
                </div>
                
                <!-- Metadata -->
                <div class="setting-item">
                    <div class="setting-name">Last Updated</div>
                    <div class="setting-desc">
                        {{ settings._metadata.last_updated }} by {{ settings._metadata.updated_by }}
                    </div>
                </div>
                
                <!-- Save Button -->
                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary btn-save">üíæ Save System Settings</button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>
